{% extends "base.html" %}
{% block content %}
<h2 class="text-xl font-bold mb-4">Λήψη Παραστατικών</h2>

<form method="POST" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
  <div>
    <label>Ημερομηνία Από</label>
    <input type="text" name="date_from" placeholder="dd/mm/yyyy" class="w-full border rounded p-2" required>
  </div>
  <div>
    <label>Ημερομηνία Έως</label>
    <input type="text" name="date_to" placeholder="dd/mm/yyyy" class="w-full border rounded p-2" required>
  </div>
  <div>
    <label>Χρήση Credential</label>
    <select name="use_credential" class="w-full border rounded p-2">
      <option value="">Default</option>
      {% for c in credentials %}
        <option value="{{ c.name }}">{{ c.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-span-3 mt-2">
    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Fetch</button>
  </div>
</form>

{% if error %}
  <div class="p-2 bg-red-100 text-red-800 rounded mb-2">{{ error }}</div>
{% endif %}
{% if message %}
  <div class="p-2 bg-green-100 text-green-800 rounded mb-2">{{ message }}</div>
{% endif %}

<div class="overflow-auto">
  <table id="previewTable" class="min-w-full border border-gray-200 table-auto">
    <thead class="bg-gray-100">
      <tr>
        {% if preview %}
          {% for k in preview[0].keys() %}
            <th class="border px-2 py-1">{{ k }}</th>
          {% endfor %}
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for d in preview %}
      <tr class="hover:bg-gray-50">
        {% for v in d.values() %}
          <td class="border px-2 py-1">{{ v }}</td>
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  new simpleDatatables.DataTable("#previewTable", {
    searchable: true,
    fixedHeight: true,
  });
});
</script>
{% endblock %}
