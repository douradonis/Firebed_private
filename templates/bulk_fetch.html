<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>Bulk Fetch MYDATA</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
label { display: inline-block; width: 100px; margin-bottom: 6px; }
input, select { padding: 5px; width: 200px; margin-bottom: 10px; }
button { padding: 6px 12px; }
table { border-collapse: collapse; width: 100%; margin-top: 20px; }
th, td { border: 1px solid #ccc; padding: 5px; text-align: left; }
th { background-color: #eee; }
.error { color: red; margin-bottom: 10px; }
.message { color: green; margin-bottom: 10px; }
</style>
</head>
<body>

<h2>Bulk Fetch MYDATA</h2>

{% if error %}
<div class="error">{{ error }}</div>
{% endif %}
{% if message %}
<div class="message">{{ message }}</div>
{% endif %}

<form method="POST">
    <label for="use_credential">Χρήση Credential:</label>
    <select id="use_credential" name="use_credential">
        <option value="">--Επιλέξτε--</option>
        {% for c in credentials %}
        <option value="{{ c.name }}">{{ c.name }}</option>
        {% endfor %}
    </select><br>

    <label for="vat_number">ΑΦΜ:</label>
    <input type="text" id="vat_number" name="vat_number" value="" placeholder="προαιρετικό"><br>

    <label for="date_from">Από:</label>
    <input type="text" id="date_from" name="date_from" placeholder="dd/mm/YYYY" value="{{ default_from }}" required><br>

    <label for="date_to">Έως:</label>
    <input type="text" id="date_to" name="date_to" placeholder="dd/mm/YYYY" value="{{ default_to }}" required><br>

    <button type="submit">Fetch</button>
</form>

<h3>Preview (πρώτες 40 γραμμές)</h3>
<table>
    <thead>
        {% if preview %}
        <tr>
        {% for key in preview[0].keys() %}
            <th>{{ key }}</th>
        {% endfor %}
        </tr>
        {% endif %}
    </thead>
    <tbody>
        {% for row in preview %}
        <tr>
            {% for v in row.values() %}
            <td>{{ v }}</td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
document.addEventListener("DOMContentLoaded", function() {
    function formatDateInput(e) {
        let v = e.target.value.replace(/\D/g, '').slice(0,8);
        if(v.length>=4) v=v.slice(0,2)+'/'+v.slice(2,4)+'/'+v.slice(4);
        else if(v.length>=2) v=v.slice(0,2)+'/'+v.slice(2);
        e.target.value = v;
    }
    document.getElementById('date_from').addEventListener('input', formatDateInput);
    document.getElementById('date_to').addEventListener('input', formatDateInput);
});
</script>

</body>
</html>
