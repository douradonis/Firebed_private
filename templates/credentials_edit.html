{% extends "base.html" %}
{% block title %}Edit credential: {{ credential.name }}{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto mt-6">
  <h2 class="text-lg font-semibold mb-4">Επεξεργασία Credential</h2>

  <form method="post" class="space-y-3">
    <div>
      <label class="block text-sm font-medium text-gray-700">Name (unique)</label>
      <input name="name" type="text" value="{{ credential.name }}" required class="mt-1 block w-full rounded-md border px-3 py-2" />
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700">User (AADE User)</label>
      <input name="user" type="text" value="{{ credential.user }}" class="mt-1 block w-full rounded-md border px-3 py-2" />
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700">Key (Subscription key)</label>
      <input name="key" type="text" value="{{ credential.key }}" class="mt-1 block w-full rounded-md border px-3 py-2" />
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700">Env</label>
      <input name="env" type="text" value="{{ credential.env }}" class="mt-1 block w-full rounded-md border px-3 py-2" />
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700">VAT</label>
      <input name="vat" type="text" value="{{ credential.vat }}" class="mt-1 block w-full rounded-md border px-3 py-2" />
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700">Κατηγορία βιβλίων</label>
      <select name="book_category" class="mt-1 block w-full rounded-md border px-3 py-2">
        <option value="Β" {% if credential.book_category=='Β' %}selected{% endif %}>Β</option>
        <option value="Γ" {% if credential.book_category=='Γ' %}selected{% endif %}>Γ</option>
      </select>
    </div>

    <div>
      <label class="inline-flex items-center mt-1">
        <input type="checkbox" name="fpa_applicable" id="pageFpa" class="mr-2" {% if credential.fpa_applicable %}checked{% endif %}>
        Υπαγωγή στον ΦΠΑ
      </label>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700">Κατηγορίες εξόδων</label>
      <select name="expense_tags" id="pageExpenseTags" multiple class="mt-1 block w-full rounded-md border px-3 py-2">
        {% set tags = credential.expense_tags or [] %}
        <option value="αγορες_εμπορευματων" {% if 'αγορες_εμπορευματων' in tags %}selected{% endif %}>Αγορές εμπορευμάτων</option>
        <option value="αγορες_α_υλων" {% if 'αγορες_α_υλων' in tags %}selected{% endif %}>Αγορές α' υλών</option>
        <option value="γενικες_δαπανες" {% if 'γενικες_δαπανες' in tags %}selected{% endif %}>Γενικές δαπάνες</option>
        <option value="αμοιβες_τριτων" {% if 'αμοιβες_τριτων' in tags %}selected{% endif %}>Αμοιβές και έξοδα τρίτων</option>
        <option value="δαπανες_χωρις_φπα" {% if 'δαπανες_χωρις_φπα' in tags %}selected{% endif %}>Δαπάνες χωρίς δικαίωμα έκπτωσης ΦΠΑ</option>
      </select>
    </div>

    <div class="flex gap-2">
      <button type="submit" class="px-4 py-2 rounded bg-sky-600 text-white">Αποθήκευση</button>
      <a href="{{ url_for('credentials') }}" class="px-4 py-2 rounded border">Άκυρο</a>
    </div>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const fpa = document.getElementById('pageFpa');
  const tags = document.getElementById('pageExpenseTags');
  function toggleTag(){
    for(const opt of tags.options){
      if(opt.value === 'δαπανες_χωρις_φπα'){
        opt.disabled = !fpa.checked;
        if(!fpa.checked) opt.selected = false;
      }
    }
  }
  if(fpa && tags){
    fpa.addEventListener('change', toggleTag);
    toggleTag();
  }
});
</script>
{% endblock %}
