{% extends "base.html" %}
{% block title %}Custom Κατηγορίες{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto mt-6 space-y-6">
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-bold text-gray-800">Custom κατηγορίες χαρακτηρισμών</h1>
    <a href="{{ url_for('search') }}" class="px-3 py-2 border rounded text-sm">⬅ Επιστροφή</a>
  </div>

  {% if not vat %}
    <div class="bg-yellow-50 border border-yellow-200 text-yellow-900 rounded p-4">
      Δεν έχει επιλεγεί ενεργός πελάτης. Ενεργοποίησε κάποιο credential και δοκίμασε ξανά.
    </div>
  {% else %}
    <div class="bg-slate-50 border border-slate-200 rounded p-4 text-sm text-slate-700">
      <p><strong>Πελάτης:</strong> {{ vat }}</p>
      <p class="mt-2">Οι παρακάτω κατηγορίες είναι διαθέσιμες επιπλέον των γενικών:<br>
        <span class="italic">{{ default_labels.values() | list | join(', ') }}</span>
      </p>
    </div>

    <div class="space-y-4">
      {% for cat in categories %}
        <form method="post" action="{{ url_for('custom_categories_save') }}" class="border border-gray-200 rounded-lg p-4 bg-white shadow-sm space-y-3">
          <input type="hidden" name="vat" value="{{ vat }}">
          <input type="hidden" name="id" value="{{ cat.id }}">
          <div class="flex flex-wrap gap-4 items-center">
            <div class="flex-1 min-w-[240px]">
              <label class="block text-sm font-medium">Τίτλος</label>
              <input type="text" name="label" value="{{ cat.label }}" class="w-full border rounded px-2 py-1" required>
            </div>
            <label class="inline-flex items-center text-sm font-medium mt-6 md:mt-0">
              <input type="checkbox" name="enabled" class="mr-2" {% if cat.enabled %}checked{% endif %}>
              Ενεργή για τιμολόγια
            </label>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
            {% for rate in vat_rates %}
              <div>
                <label class="block text-xs uppercase tracking-wide text-gray-600">ΦΠΑ {{ rate }}%</label>
                <input type="text" name="account_{{ rate }}" value="{{ cat.accounts[rate] }}" class="w-full border rounded px-2 py-1" placeholder="Λογαριασμός">
              </div>
            {% endfor %}
          </div>

          <div class="flex justify-end gap-2">
            <button type="submit" class="px-3 py-2 bg-sky-600 text-white rounded">Αποθήκευση</button>
            <button type="submit"
                    formaction="{{ url_for('custom_categories_delete') }}"
                    formmethod="post"
                    class="px-3 py-2 bg-red-600 text-white rounded"
                    onclick="return confirm('Να διαγραφεί η κατηγορία {{ cat.label }};');">
              Διαγραφή
            </button>
          </div>
        </form>
      {% else %}
        <div class="text-sm text-gray-600">
          Δεν υπάρχουν custom κατηγορίες ακόμη.
        </div>
      {% endfor %}
    </div>

    <div class="border-t pt-4">
      <h2 class="text-lg font-semibold mb-3">Νέα κατηγορία</h2>
      <form method="post" action="{{ url_for('custom_categories_save') }}" class="border border-dashed border-gray-300 rounded-lg p-4 bg-white space-y-3">
        <input type="hidden" name="vat" value="{{ vat }}">
        <div class="flex flex-wrap gap-4 items-center">
          <div class="flex-1 min-w-[240px]">
            <label class="block text-sm font-medium">Τίτλος</label>
            <input type="text" name="label" class="w-full border rounded px-2 py-1" placeholder="π.χ. Καύσιμα" required>
          </div>
          <label class="inline-flex items-center text-sm font-medium mt-6 md:mt-0">
            <input type="checkbox" name="enabled" class="mr-2" checked>
            Ενεργή για τιμολόγια
          </label>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
          {% for rate in vat_rates %}
            <div>
              <label class="block text-xs uppercase tracking-wide text-gray-600">ΦΠΑ {{ rate }}%</label>
              <input type="text" name="account_{{ rate }}" class="w-full border rounded px-2 py-1" placeholder="Λογαριασμός">
            </div>
          {% endfor %}
        </div>
        <div class="flex justify-end">
          <button type="submit" class="px-3 py-2 bg-green-600 text-white rounded">Προσθήκη</button>
        </div>
      </form>
    </div>
  {% endif %}
</div>
{% endblock %}
