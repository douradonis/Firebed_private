<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{% block title %}ScanmyData{% endblock %}</title>
  
  <link rel="icon" type="image/png" href="/icons/web-app-manifest-192x192.png" sizes="192x192" />
  <link rel="icon" type="image/png" href="/icons/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg" />
  <link rel="shortcut icon" href="/icons/favicon.ico" />
  <link rel="apple-touch-icon" sizes="256x256" href="/icons/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="ScanmyData" />
  <link rel="manifest" href="/icons/site.webmanifest" />

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='dialogs.css') }}">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="{{ url_for('static', filename='modal_utils.js') }}"></script>
  <script src="{{ url_for('static', filename='dialogs.js') }}"></script>

  <style>
    :root { 
      --device-font-scale: 1; 
      --bg-primary: #f3f4f6;
      --bg-secondary: white;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --border-color: #e5e7eb;
      --shadow-color: rgba(0,0,0,0.04);
    }
    
    [data-theme="dark"] {
      --bg-primary: #111827;
      --bg-secondary: #1f2937;
      --text-primary: #f9fafb;
      --text-secondary: #e5e7eb;
      --border-color: #6b7280;
      --shadow-color: rgba(0,0,0,0.5);
    }
    
    html { font-size: calc(16px * var(--device-font-scale, 1)); }
    body { 
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; 
      background: var(--bg-primary); 
      color: var(--text-primary);
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .container { max-width: 1100px; margin: 28px auto; padding: 16px; }
    .content-wrap { 
      background: var(--bg-secondary); 
      padding: 16px; 
      border-radius: 8px; 
      box-shadow: 0 1px 2px var(--shadow-color);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }

    body[data-device='mobile'] .container {
      max-width: 100%;
      margin: 16px auto;
      padding: 12px;
    }

    body[data-device='tablet'] .container {
      max-width: 1000px;
      padding: 16px;
    }

    body[data-device='mobile'] .content-wrap {
      padding: 12px;
      border-radius: 16px;
    }

    body[data-device='mobile'] h1 {
      font-size: 1.75rem;
    }

    .layout-header__nav {
      flex-wrap: wrap;
    }

    body[data-device='tablet'] .layout-header__right {
      align-items: stretch;
      width: 100%;
    }

    body[data-device='tablet'] .layout-header__nav {
      flex-wrap: wrap;
      justify-content: flex-start;
    }

    body[data-device='tablet'] .layout-header__top-row {
      align-items: stretch;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    body[data-device='tablet'] .layout-header__year-row {
      width: 100%;
      justify-content: flex-start;
    }

    body[data-device='mobile'] .layout-header {
      flex-direction: column;
      align-items: stretch;
      gap: 1rem;
    }

    body[data-device='mobile'] .layout-header__brand {
      width: 100%;
    }

    body[data-device='mobile'] .layout-header__right {
      width: 100%;
      align-items: stretch;
      gap: 0.75rem;
    }

    body[data-device='mobile'] .layout-header__top-row {
      flex-direction: column;
      align-items: stretch;
      gap: 0.75rem;
      width: 100%;
    }

    body[data-device='mobile'] .layout-header__nav {
      width: 100%;
      overflow-x: auto;
      flex-wrap: nowrap;
      justify-content: flex-start;
      gap: 0.5rem;
    }

    body[data-device='mobile'] .layout-header__nav a {
      flex: 0 0 auto;
      white-space: nowrap;
      font-size: 0.95rem;
      padding: 0.55rem 0.75rem;
    }

    body[data-device='mobile'] .layout-header__nav::-webkit-scrollbar {
      height: 6px;
    }

    body[data-device='mobile'] .layout-header__nav::-webkit-scrollbar-thumb {
      background: rgba(14,165,233,0.45);
      border-radius: 999px;
    }

    body[data-device='mobile'] .layout-header__active {
      justify-content: space-between;
    }

    body[data-device='mobile'] .layout-header__year-row {
      width: 100%;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: flex-start;
    }

    body[data-device='mobile'] .layout-header__year-row label {
      flex: 1 1 100%;
    }

    body[data-device='mobile'] .layout-header__year-row select,
    body[data-device='mobile'] .layout-header__year-row button,
    body[data-device='mobile'] .layout-header__year-row span {
      flex: 1 1 calc(50% - 0.5rem);
      min-width: 0;
    }

    .flash-banner { border-radius: 8px; padding: 10px 14px; font-weight:500; box-shadow:0 1px 2px rgba(0,0,0,0.05); }
    .flash-success { background:#ecfdf5; color:#065f46; border:1px solid #bbf7d0; }
    .flash-error   { background:#fee2e2; color:#991b1b; border:1px solid #fca5a5; }
    .flash-warning { background:#fef3c7; color:#92400e; border:1px solid #fde68a; }
    .flash-info    { background:#e0f2fe; color:#075985; border:1px solid #bae6fd; }
    
    /* Dark mode overrides for flash messages */
    [data-theme="dark"] .flash-success { background:#064e3b; color:#d1fae5; border-color:#065f46; }
    [data-theme="dark"] .flash-error   { background:#7f1d1d; color:#fecaca; border-color:#991b1b; }
    [data-theme="dark"] .flash-warning { background:#78350f; color:#fef3c7; border-color:#92400e; }
    [data-theme="dark"] .flash-info    { background:#0c4a6e; color:#bae6fd; border-color:#075985; }
    
    /* Dark mode overrides for UI elements */
    [data-theme="dark"] input,
    [data-theme="dark"] select,
    [data-theme="dark"] textarea,
    [data-theme="dark"] button:not(.bg-sky-600):not(.bg-red-600):not(.bg-emerald-600) {
      background-color: #1f2937;
      color: #f9fafb;
      border-color: #6b7280;
      border-width: 1px;
    }
    
    [data-theme="dark"] input::placeholder,
    [data-theme="dark"] textarea::placeholder {
      color: #9ca3af;
    }
    
    [data-theme="dark"] input:focus,
    [data-theme="dark"] select:focus,
    [data-theme="dark"] textarea:focus {
      background-color: #111827;
      border-color: #60a5fa;
      outline: none;
      box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
    }
    
    [data-theme="dark"] .layout-header__nav a:not(.bg-sky-600) {
      background-color: #1f2937;
      color: #f9fafb;
      border-color: #6b7280;
      border-width: 1px;
    }
    
    /* stronger header nav hover in light mode */
    .layout-header__nav a:not(.bg-sky-600):hover {
      background-color: #e6f7ff;
      color: #075985;
      box-shadow: 0 6px 18px rgba(14,165,233,0.06);
      transform: translateY(-1px);
    }

    [data-theme="dark"] .layout-header__nav a:not(.bg-sky-600):hover {
      background-color: #0ea5e9;
      color: #04263a;
      border-color: #0ea5e9;
      box-shadow: 0 6px 22px rgba(14,165,233,0.18);
      transform: translateY(-1px);
    }
    
    [data-theme="dark"] #sideMenu {
      background-color: #1f2937;
      border-left: 1px solid #6b7280;
    }
    
    [data-theme="dark"] .modal-warning-panel {
      background-color: var(--bg-secondary);
      color: var(--text-primary);
    }
    
    /* Dark mode for info boxes (blue backgrounds) */
    [data-theme="dark"] .bg-blue-50 {
      background-color: rgba(30, 58, 138, 0.3) !important;
    }
    
    [data-theme="dark"] .border-blue-200 {
      border-color: #1e40af !important;
    }
    
    [data-theme="dark"] .text-gray-700 {
      color: #d1d5db !important;
    }
    
    /* Additional dark mode overrides for better visibility */
    [data-theme="dark"] table {
      color: var(--text-primary);
      background-color: #1f2937;
    }
    
    [data-theme="dark"] table th {
      background-color: #374151;
      color: #f9fafb;
      border-color: #6b7280;
    }
    
    [data-theme="dark"] table td {
      border-color: #4b5563;
    }
    
    [data-theme="dark"] table tbody tr:hover {
      background-color: #374151;
    }
    
    /* Bootstrap table-striped and table-hover - Dark Mode */
    [data-theme="dark"] .table-striped tbody tr:nth-of-type(odd) {
      background-color: #1f2937 !important;
    }
    
    [data-theme="dark"] .table-striped tbody tr:nth-of-type(even) {
      background-color: #111827 !important;
    }
    
    [data-theme="dark"] .table-hover tbody tr:hover {
      background-color: #374151 !important;
    }
    
    [data-theme="dark"] .table-dark {
      background-color: #374151 !important;
      color: #f9fafb !important;
    }
    
    [data-theme="dark"] .table-dark th,
    [data-theme="dark"] .table-dark td {
      border-color: #4b5563 !important;
    }
    
    [data-theme="dark"] code,
    [data-theme="dark"] pre {
      background-color: #111827 !important;
      color: #e5e7eb !important;
      border: 1px solid #374151 !important;
    }
    
    /* Bootstrap container and rows - Dark Mode */
    [data-theme="dark"] .container,
    [data-theme="dark"] .container-fluid {
      color: #f9fafb !important;
    }
    
    [data-theme="dark"] .row {
      color: #f9fafb !important;
    }
    
    [data-theme="dark"] small,
    [data-theme="dark"] .small {
      color: #d1d5db !important;
    }
    
    [data-theme="dark"] .display-4 {
      color: inherit !important;
    }
    
    /* Fix for Bootstrap text utilities */
    [data-theme="dark"] .text-dark {
      color: #f9fafb !important;
    }
    
    [data-theme="dark"] .text-white {
      color: white !important;
    }
    
    /* Custom Tab Buttons (for admin dashboard) - Dark Mode */
    [data-theme="dark"] .tab-button {
      color: #9ca3af !important;
      border-bottom-color: transparent !important;
    }
    
    [data-theme="dark"] .tab-button:hover {
      color: #e5e7eb !important;
    }
    
    [data-theme="dark"] .tab-button.active {
      color: #0ea5e9 !important;
      border-bottom-color: #0ea5e9 !important;
    }
    
    /* Gradient backgrounds - Dark Mode adjustments */
    [data-theme="dark"] .from-blue-50 {
      background: linear-gradient(to bottom right, #1e3a5f, #0c2340) !important;
    }
    
    [data-theme="dark"] .from-green-50 {
      background: linear-gradient(to bottom right, #064e3b, #022c22) !important;
    }
    
    [data-theme="dark"] .from-purple-50 {
      background: linear-gradient(to bottom right, #581c87, #3b0764) !important;
    }
    
    [data-theme="dark"] .from-orange-50 {
      background: linear-gradient(to bottom right, #7c2d12, #431407) !important;
    }
    
    [data-theme="dark"] .text-blue-700,
    [data-theme="dark"] .text-blue-900 {
      color: #93c5fd !important;
    }
    
    [data-theme="dark"] .text-green-700,
    [data-theme="dark"] .text-green-900 {
      color: #86efac !important;
    }
    
    [data-theme="dark"] .text-purple-700,
    [data-theme="dark"] .text-purple-900 {
      color: #d8b4fe !important;
    }
    
    [data-theme="dark"] .text-orange-700,
    [data-theme="dark"] .text-orange-900 {
      color: #fdba74 !important;
    }
    
    [data-theme="dark"] .text-blue-600 {
      color: #60a5fa !important;
    }
    
    [data-theme="dark"] .text-green-600 {
      color: #4ade80 !important;
    }
    
    [data-theme="dark"] .text-purple-600 {
      color: #c084fc !important;
    }
    
    [data-theme="dark"] .text-orange-600 {
      color: #fb923c !important;
    }
    
    [data-theme="dark"] .border-blue-200,
    [data-theme="dark"] .border-green-200,
    [data-theme="dark"] .border-purple-200,
    [data-theme="dark"] .border-orange-200 {
      border-color: #4b5563 !important;
    }
    
    [data-theme="dark"] .bg-gray-50 {
      background-color: #374151 !important;
    }
    
    [data-theme="dark"] .dataTables_wrapper {
      color: var(--text-primary);
    }
    
    [data-theme="dark"] .dataTables_wrapper .dataTables_length,
    [data-theme="dark"] .dataTables_wrapper .dataTables_filter,
    [data-theme="dark"] .dataTables_wrapper .dataTables_info,
    [data-theme="dark"] .dataTables_wrapper .dataTables_paginate {
      color: var(--text-primary);
    }
    
    [data-theme="dark"] label,
    [data-theme="dark"] .text-gray-500,
    [data-theme="dark"] .text-gray-600,
    [data-theme="dark"] .text-gray-700 {
      color: #e5e7eb !important;
    }
    
    [data-theme="dark"] .text-gray-900,
    [data-theme="dark"] h1, [data-theme="dark"] h2, 
    [data-theme="dark"] h3, [data-theme="dark"] h4,
    [data-theme="dark"] h5, [data-theme="dark"] h6 {
      color: #f9fafb !important;
    }
    
    [data-theme="dark"] .bg-white {
      background-color: #1f2937 !important;
    }
    
    [data-theme="dark"] .bg-gray-100 {
      background-color: #374151 !important;
      color: #e5e7eb !important;
    }
    
    [data-theme="dark"] .bg-gray-200 {
      background-color: #4b5563 !important;
      color: #f3f4f6 !important;
    }
    
    [data-theme="dark"] .border {
      border-color: #6b7280 !important;
    }
    
    [data-theme="dark"] .content-wrap {
      background-color: #1f2937;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
      border: 1px solid #374151;
    }
    
    [data-theme="dark"] .rounded,
    [data-theme="dark"] .rounded-md,
    [data-theme="dark"] .rounded-lg {
      border: 1px solid #4b5563;
    }
    
    [data-theme="dark"] a:not(.bg-sky-600):not(.bg-red-600):not(.bg-emerald-600) {
      color: #60a5fa;
    }
    
    [data-theme="dark"] a:not(.bg-sky-600):not(.bg-red-600):not(.bg-emerald-600):hover {
      color: #93c5fd;
    }
    
    /* Preserve red color for Admin button in dark mode */
    /* make admin/logout style consistent with side-logout in dark mode */
    [data-theme="dark"] .layout-header__nav a.bg-red-600 {
      background-color: #7f1d1d !important;
      color: white !important;
      box-shadow: 0 8px 24px rgba(127,29,29,0.18);
    }

    [data-theme="dark"] .layout-header__nav a.bg-red-600:hover {
      background-color: #5f1212 !important;
    }

    /* make admin button match logout tone in light mode as well */
    .layout-header__nav a.bg-red-600 {
      background-color: #fee2e2 !important;
      color: #7f1d1d !important;
      border: 1px solid transparent;
    }
    .layout-header__nav a.bg-red-600:hover {
      background-color: #fca5a5 !important;
      color: #7f1d1d !important;
    }

    /* Warning modal styling (shared look & feel) */
    [data-role="modal-warning"] { display: none; }
    [data-role="modal-warning"].flex,
    [data-role="modal-warning"].grid { display: flex; }

    .modal-warning-panel {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.15);
      width: 100%;
      max-width: 420px;
      padding: 24px;
      position: relative;
    }

    .modal-warning-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      font-size: 1.125rem;
      color: #b91c1c;
    }

    .modal-warning-body {
      margin-top: 12px;
      margin-bottom: 22px;
      color: #374151;
      font-size: 0.95rem;
      line-height: 1.55;
    }

    .modal-warning-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .modal-warning-btn {
      border-radius: 10px;
      padding: 9px 16px;
      font-weight: 500;
      font-size: 0.95rem;
      transition: background-color .18s ease, color .18s ease, border-color .18s ease;
    }

    .modal-warning-btn--muted {
      border: 1px solid #d1d5db;
      background: #ffffff;
      color: #374151;
    }

    .modal-warning-btn--muted:hover {
      background: #f3f4f6;
    }

    .modal-warning-btn--danger {
      background: #dc2626;
      color: #ffffff;
      border: 1px solid transparent;
    }

    .modal-warning-btn--danger:hover {
      background: #b91c1c;
    }

    .modal-warning-btn--confirm {
      background: #b91c1c;
      color: #ffffff;
      border: 1px solid transparent;
    }

    .modal-warning-btn--confirm:hover {
      background: #9f1239;
    }

    /* Brighter modal warning background in dark mode for improved contrast */
    [data-theme="dark"] .modal-warning-panel {
      background-color: #374151 !important; /* lighter than var(--bg-secondary) */
      color: #f8fafc !important;
      border: 1px solid #4b5563;
      box-shadow: 0 18px 42px rgba(2,6,23,0.35);
    }
    [data-theme="dark"] .modal-warning-body { 
      color: #f8fafc !important; 
    }
    
    [data-theme="dark"] .modal-warning-title {
      color: #fca5a5 !important;
    }
    
    [data-theme="dark"] .modal-warning-btn--muted {
      background-color: #4b5563 !important;
      color: #e5e7eb !important;
      border-color: #6b7280 !important;
    }
    
    [data-theme="dark"] .modal-warning-btn--muted:hover {
      background-color: #374151 !important;
    }
    
    [data-theme="dark"] .modal-warning-btn--danger,
    [data-theme="dark"] .modal-warning-btn--confirm {
      background-color: #dc2626 !important;
      color: white !important;
      border-color: #dc2626 !important;
    }
    
    [data-theme="dark"] .modal-warning-btn--danger:hover,
    [data-theme="dark"] .modal-warning-btn--confirm:hover {
      background-color: #b91c1c !important;
    }

    .modal-warning-close {
      position: absolute;
      top: 18px;
      right: 18px;
      border: none;
      background: transparent;
      color: #9ca3af;
      font-size: 1.25rem;
      line-height: 1;
      cursor: pointer;
    }

    .modal-warning-close:hover {
      color: #6b7280;
    }

    /* optional, αν θέλεις και warning/info:
    .flash-warning { background:#fef3c7; color:#92400e; border:1px solid #fde68a; }
    .flash-info    { background:#e0f2fe; color:#075985; border:1px solid #bae6fd; } */
  </style>
  
  <style>
    /* Dark mode toggle switch */
    .theme-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .theme-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .theme-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .3s;
      border-radius: 24px;
    }
    
    .theme-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }
    
    input:checked + .theme-slider {
      background-color: #0ea5e9;
    }
    
    input:checked + .theme-slider:before {
      transform: translateX(26px);
    }
    
    /* Authentication pages styling - Universal rules for login, signup, forgot password, landing */
    /* Light mode - dark text for readability */
    body h1, body h2, body h3 {
      color: #111827;
    }
    
    body p, body span:not([class*="bg-"]), body small, body label span {
      color: #1f2937;
    }
    
    /* Dark mode - light text for readability */
    [data-theme="dark"] h1, 
    [data-theme="dark"] h2, 
    [data-theme="dark"] h3 {
      color: #f9fafb;
    }
    
    [data-theme="dark"] p:not(.text-white):not([class*="text-sky"]):not([class*="text-red"]):not([class*="text-green"]):not([class*="text-yellow"]):not([class*="bg-"]), 
    [data-theme="dark"] span:not(.text-white):not([class*="text-sky"]):not([class*="text-red"]):not([class*="text-green"]):not([class*="text-yellow"]):not([class*="bg-"]):not([class*="theme-slider"]), 
    [data-theme="dark"] small:not(.text-white):not([class*="text-sky"]):not([class*="text-red"]):not([class*="text-green"]):not([class*="text-yellow"]):not([class*="bg-"]), 
    [data-theme="dark"] label span {
      color: #e5e7eb;
    }
    
    /* Inputs and borders in dark mode */
    [data-theme="dark"] input:not([type="submit"]):not([type="button"]):not([type="checkbox"]),
    [data-theme="dark"] textarea,
    [data-theme="dark"] select {
      background-color: #374151;
      border-color: #4b5563;
      color: #f9fafb;
    }
    
    [data-theme="dark"] input::placeholder,
    [data-theme="dark"] textarea::placeholder {
      color: #9ca3af;
    }
    
    [data-theme="dark"] .border-gray-300,
    [data-theme="dark"] .border-t {
      border-color: #4b5563 !important;
    }
    
    [data-theme="dark"] .border-blue-200 {
      border-color: #1e40af !important;
    }
    
    [data-theme="dark"] .bg-blue-50 {
      background-color: #1e3a8a33 !important;
    }
    
    /* Feature cards in landing page */
    [data-theme="dark"] .bg-white:not(.hover\:bg-gray-50):not(button) {
      background-color: #1f2937 !important;
    }
    
    [data-theme="dark"] .border-gray-200 {
      border-color: #374151 !important;
    }
    
    [data-theme="dark"] .bg-gradient-to-br {
      background-image: linear-gradient(to bottom right, #1f2937, #111827) !important;
    }
    
    /* CTA buttons in dark mode */
    [data-theme="dark"] .bg-white.hover\:bg-gray-50 {
      background-color: #374151 !important;
      color: #f9fafb !important;
      border-color: #4b5563 !important;
    }
    
    [data-theme="dark"] .bg-white.hover\:bg-gray-50:hover {
      background-color: #4b5563 !important;
    }
    
    [data-theme="dark"] .bg-sky-600 {
      background-color: #075985 !important;
    }
    
    [data-theme="dark"] .bg-sky-600:hover,
    [data-theme="dark"] .hover\:bg-sky-700:hover {
      background-color: #0c4a6e !important;
    }
    
    /* Table styling - Universal rules for all tables */
    /* Light mode - dark text for readability */
    table, table td, table th {
      color: #111827 !important;
    }
    
    table a {
      color: #0369a1 !important;
    }
    
    table a:hover {
      color: #075985 !important;
    }
    
    table th {
      background-color: #f3f4f6 !important;
      font-weight: 600;
      color: #111827 !important;
    }
    
    table tbody tr:nth-child(even) {
      background-color: #f9fafb !important;
    }
    
    table tbody tr:hover {
      background-color: #f3f4f6 !important;
    }
    
    /* Dark mode - light text for readability */
    [data-theme="dark"] table,
    [data-theme="dark"] table td,
    [data-theme="dark"] table th {
      color: #f9fafb !important;
      border-color: #4b5563 !important;
    }
    
    [data-theme="dark"] table a {
      color: #60a5fa !important;
    }
    
    [data-theme="dark"] table a:hover {
      color: #93c5fd !important;
    }
    
    [data-theme="dark"] table thead,
    [data-theme="dark"] table th {
      background-color: #374151 !important;
    }
    
    [data-theme="dark"] table tbody tr:nth-child(even) {
      background-color: #1f293733 !important;
    }
    
    [data-theme="dark"] table tbody tr:hover {
      background-color: #37415133 !important;
    }
    
    /* Logged-in landing page (nav.html when authenticated) */
    /* Light mode - ensure readability */
    .content-wrap h1,
    .content-wrap h2,
    .content-wrap h3 {
      color: #111827 !important;
    }
    
    .content-wrap p {
      color: #1f2937 !important;
    }
    
    .content-wrap a:not([class*="bg-"]) {
      color: #0369a1 !important;
    }
    
    .content-wrap a:not([class*="bg-"]):hover {
      color: #075985 !important;
    }
    
    /* Dark mode overrides for logged-in landing */
    [data-theme="dark"] .content-wrap h1,
    [data-theme="dark"] .content-wrap h2,
    [data-theme="dark"] .content-wrap h3 {
      color: #f9fafb !important;
    }
    
    [data-theme="dark"] .content-wrap p {
      color: #e5e7eb !important;
    }
    
    [data-theme="dark"] .content-wrap a:not([class*="bg-"]) {
      color: #60a5fa !important;
    }
    
    [data-theme="dark"] .content-wrap a:not([class*="bg-"]):hover {
      color: #93c5fd !important;
    }
    
    /* Side menu buttons - white background buttons */
    /* Light mode - make text clearly visible */
    a.bg-white,
    button.bg-white {
      background-color: #ffffff !important;
      color: #1f2937 !important;
      border-color: #d1d5db !important;
    }
    
    a.bg-white:hover,
    button.bg-white:hover {
      background-color: #f9fafb !important;
      color: #111827 !important;
    }
    
    /* Specific for unauthenticated nav.html buttons */
    nav a.bg-white,
    .content-wrap a.bg-white {
      background-color: #ffffff !important;
      color: #1f2937 !important;
      border: 2px solid #d1d5db !important;
    }
    
    nav a.bg-white:hover,
    .content-wrap a.bg-white:hover {
      background-color: #f9fafb !important;
      color: #111827 !important;
      border-color: #9ca3af !important;
    }
    
    /* Dark mode */
    [data-theme="dark"] a.bg-white,
    [data-theme="dark"] button.bg-white {
      background-color: #374151 !important;
      color: #f9fafb !important;
      border-color: #4b5563 !important;
    }
    
    [data-theme="dark"] a.bg-white:hover,
    [data-theme="dark"] button.bg-white:hover {
      background-color: #4b5563 !important;
      color: #ffffff !important;
    }
    
    .logo-img {
      height: 120px;
      width: auto;
      max-width: 100%;
    }
    
    body[data-device='mobile'] .logo-img {
      height: 90px;
    }
    
    body[data-device='tablet'] .logo-img {
      height: 100px;
    }
    
    [data-theme="dark"] .logo-light {
      display: none;
    }
    
    [data-theme="dark"] .logo-dark {
      display: block;
    }
    
    .logo-light {
      display: block;
    }
    
    .logo-dark {
      display: none;
    }
  </style>

  <style>
    /* Dark-mode button hover improvements */
    [data-theme="dark"] button:hover,
    [data-theme="dark"] .btn:hover,
    [data-theme="dark"] .theme-slider:hover,
    [data-theme="dark"] a:hover {
      filter: brightness(1.06);
      opacity: 0.98;
    }

    /* Stronger header menu hover for both themes */
    .layout-header__nav a:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(2,6,23,0.06);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    [data-theme="dark"] .layout-header__nav a:hover {
      filter: brightness(1.12);
      background-color: rgba(14,165,233,0.12) !important;
      color: #e6f7ff !important;
    }

    /* Side menu active / emphasized links */
    #sideMenu a.side-menu-active {
      background-color: #e6f7ff;
      color: #075985;
      border-radius: 6px;
    }
    [data-theme="dark"] #sideMenu a.side-menu-active {
      background-color: #0ea5e9;
      color: #04263a;
      box-shadow: 0 6px 18px rgba(14,165,233,0.15);
    }

    /* Stronger logout/manage-groups colours in side menu */
    #sideMenu a.side-logout { background-color: #fee2e2; color: #7f1d1d; }
    [data-theme="dark"] #sideMenu a.side-logout { background-color: #7f1d1d; color: #fff; }

    #sideMenu a.side-manage-groups { background-color: #e0f2fe; color: #075985; }
    [data-theme="dark"] #sideMenu a.side-manage-groups { background-color: #0369a1; color: #fff; }
    /* Quick Links hover should match header hover intensity */
    #sideMenu .space-y-2 a:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(2,6,23,0.04);
      background-color: #e6f7ff;
      color: #075985;
    }
    [data-theme="dark"] #sideMenu .space-y-2 a:hover {
      background-color: rgba(14,165,233,0.12) !important;
      color: #e6f7ff !important;
    }
  </style>

  <style>
    /* Standardize danger buttons to match logout tone */
    .btn-danger, button.btn-danger, .btn.btn-danger, .modal-warning-btn--danger, .modal-warning-btn--confirm {
      background: #fee2e2 !important;
      color: #7f1d1d !important;
      border-color: transparent !important;
    }

    /* Specific delete / leave / admin danger controls */
    .btn-delete-credential, .leave-group-btn, .remove-member-btn, .btn-admin, .btn-delete {
      background: #fee2e2 !important;
      color: #7f1d1d !important;
      border: 1px solid transparent !important;
    }
    
    /* Bootstrap Nav Tabs - Dark Mode Support */
    [data-theme="dark"] .nav-tabs {
      border-bottom-color: #4b5563 !important;
    }
    
    [data-theme="dark"] .nav-tabs .nav-link {
      color: #9ca3af !important;
      background-color: transparent !important;
      border-color: transparent !important;
    }
    
    [data-theme="dark"] .nav-tabs .nav-link:hover {
      color: #e5e7eb !important;
      border-color: #4b5563 #4b5563 transparent !important;
      background-color: #374151 !important;
    }
    
    [data-theme="dark"] .nav-tabs .nav-link.active {
      color: #ffffff !important;
      background-color: #0ea5e9 !important;
      border-color: #0ea5e9 #0ea5e9 #1f2937 !important;
    }
    
    /* Bootstrap Tab Content - Dark Mode */
    [data-theme="dark"] .tab-content {
      background-color: transparent !important;
    }
    
    [data-theme="dark"] .tab-pane {
      color: #f9fafb !important;
    }
    
    /* Bootstrap Cards - Dark Mode */
    [data-theme="dark"] .card {
      background-color: #1f2937 !important;
      border-color: #4b5563 !important;
      color: #f9fafb !important;
    }
    
    /* Preserve colored card backgrounds in dark mode */
    [data-theme="dark"] .card.bg-primary {
      background-color: #2563eb !important;
      color: white !important;
    }
    
    [data-theme="dark"] .card.bg-success {
      background-color: #059669 !important;
      color: white !important;
    }
    
    [data-theme="dark"] .card.bg-info {
      background-color: #0891b2 !important;
      color: white !important;
    }
    
    [data-theme="dark"] .card.bg-warning {
      background-color: #f59e0b !important;
      color: #1f2937 !important;
    }
    
    [data-theme="dark"] .card.bg-danger {
      background-color: #dc2626 !important;
      color: white !important;
    }
    
    [data-theme="dark"] .card-header,
    [data-theme="dark"] .card-footer {
      background-color: #374151 !important;
      border-color: #4b5563 !important;
      color: #f9fafb !important;
    }
    
    [data-theme="dark"] .card-body {
      color: #f9fafb !important;
    }
    
    /* Preserve text color in colored cards */
    [data-theme="dark"] .card.bg-primary .card-title,
    [data-theme="dark"] .card.bg-primary .card-text,
    [data-theme="dark"] .card.bg-success .card-title,
    [data-theme="dark"] .card.bg-success .card-text,
    [data-theme="dark"] .card.bg-info .card-title,
    [data-theme="dark"] .card.bg-info .card-text,
    [data-theme="dark"] .card.bg-danger .card-title,
    [data-theme="dark"] .card.bg-danger .card-text {
      color: white !important;
    }
    
    [data-theme="dark"] .card.bg-warning .card-title,
    [data-theme="dark"] .card.bg-warning .card-text {
      color: #1f2937 !important;
    }
    
    /* Bootstrap Buttons - Preserve Colors in Dark Mode */
    [data-theme="dark"] .btn-primary {
      background-color: #2563eb !important;
      border-color: #2563eb !important;
      color: white !important;
    }
    
    [data-theme="dark"] .btn-primary:hover {
      background-color: #1d4ed8 !important;
      border-color: #1d4ed8 !important;
    }
    
    [data-theme="dark"] .btn-success {
      background-color: #059669 !important;
      border-color: #059669 !important;
      color: white !important;
    }
    
    [data-theme="dark"] .btn-success:hover {
      background-color: #047857 !important;
      border-color: #047857 !important;
    }
    
    [data-theme="dark"] .btn-info {
      background-color: #0891b2 !important;
      border-color: #0891b2 !important;
      color: white !important;
    }
    
    [data-theme="dark"] .btn-info:hover {
      background-color: #0e7490 !important;
      border-color: #0e7490 !important;
    }
    
    [data-theme="dark"] .btn-warning {
      background-color: #f59e0b !important;
      border-color: #f59e0b !important;
      color: #1f2937 !important;
    }
    
    [data-theme="dark"] .btn-warning:hover {
      background-color: #d97706 !important;
      border-color: #d97706 !important;
    }
    
    [data-theme="dark"] .btn-danger {
      background-color: #dc2626 !important;
      border-color: #dc2626 !important;
      color: white !important;
    }
    
    [data-theme="dark"] .btn-danger:hover {
      background-color: #b91c1c !important;
      border-color: #b91c1c !important;
    }
    
    [data-theme="dark"] .btn-secondary {
      background-color: #4b5563 !important;
      border-color: #4b5563 !important;
      color: white !important;
    }
    
    [data-theme="dark"] .btn-secondary:hover {
      background-color: #374151 !important;
      border-color: #374151 !important;
    }
    
    /* Bootstrap Alerts - Dark Mode */
    [data-theme="dark"] .alert {
      background-color: #1f2937 !important;
      border-color: #4b5563 !important;
      color: #f9fafb !important;
    }
    
    [data-theme="dark"] .alert-info {
      background-color: #0c4a6e !important;
      border-color: #075985 !important;
      color: #bae6fd !important;
    }
    
    [data-theme="dark"] .alert-warning {
      background-color: #78350f !important;
      border-color: #92400e !important;
      color: #fef3c7 !important;
    }
    
    [data-theme="dark"] .alert-success {
      background-color: #064e3b !important;
      border-color: #065f46 !important;
      color: #d1fae5 !important;
    }
    
    [data-theme="dark"] .alert-danger {
      background-color: #7f1d1d !important;
      border-color: #991b1b !important;
      color: #fecaca !important;
    }
    
    /* Bootstrap Badges - Dark Mode */
    [data-theme="dark"] .badge {
      background-color: #4b5563 !important;
      color: #f9fafb !important;
    }
    
    [data-theme="dark"] .badge-primary {
      background-color: #2563eb !important;
      color: white !important;
    }
    
    [data-theme="dark"] .badge-success {
      background-color: #059669 !important;
      color: white !important;
    }
    
    [data-theme="dark"] .badge-info {
      background-color: #0891b2 !important;
      color: white !important;
    }
    
    [data-theme="dark"] .badge-warning {
      background-color: #f59e0b !important;
      color: #1f2937 !important;
    }
    
    [data-theme="dark"] .badge-danger {
      background-color: #dc2626 !important;
      color: white !important;
    }
    
    [data-theme="dark"] .badge-light {
      background-color: #6b7280 !important;
      color: #f9fafb !important;
    }
    
    /* Bootstrap Modals - Dark Mode */
    [data-theme="dark"] .modal-content {
      background-color: #1f2937 !important;
      border-color: #4b5563 !important;
      color: #f9fafb !important;
    }
    
    [data-theme="dark"] .modal-header {
      background-color: #374151 !important;
      border-bottom-color: #4b5563 !important;
      color: #f9fafb !important;
    }
    
    [data-theme="dark"] .modal-footer {
      background-color: #374151 !important;
      border-top-color: #4b5563 !important;
    }
    
    [data-theme="dark"] .modal-title {
      color: #f9fafb !important;
    }
    
    [data-theme="dark"] .close {
      color: #f9fafb !important;
      opacity: 0.8;
    }
    
    [data-theme="dark"] .close:hover {
      color: #e5e7eb !important;
      opacity: 1;
    }
    
    /* Bootstrap Form Controls - Dark Mode */
    [data-theme="dark"] .form-control,
    [data-theme="dark"] .form-select {
      background-color: #1f2937 !important;
      color: #f9fafb !important;
      border-color: #6b7280 !important;
    }
    
    [data-theme="dark"] .form-control:focus,
    [data-theme="dark"] .form-select:focus {
      background-color: #111827 !important;
      color: #f9fafb !important;
      border-color: #60a5fa !important;
      box-shadow: 0 0 0 0.2rem rgba(96, 165, 250, 0.25) !important;
    }
    
    [data-theme="dark"] .form-check-label {
      color: #e5e7eb !important;
    }
    
    [data-theme="dark"] .form-check-input {
      background-color: #374151 !important;
      border-color: #6b7280 !important;
    }
    
    [data-theme="dark"] .form-check-input:checked {
      background-color: #0ea5e9 !important;
      border-color: #0ea5e9 !important;
    }
    
    [data-theme="dark"] hr {
      border-color: #4b5563 !important;
      opacity: 0.5;
    }
    
    /* Bootstrap btn-close (X button in modals) - Dark Mode */
    [data-theme="dark"] .btn-close {
      filter: invert(1) grayscale(100%) brightness(200%);
    }

    /* Specific IDs used in lists */
    #deleteSelected, #deleteBtn {
      background: #fee2e2 !important;
      color: #7f1d1d !important;
      border: 1px solid transparent !important;
    }

    [data-theme="dark"] .btn-danger,
    [data-theme="dark"] button.btn-danger,
    [data-theme="dark"] .btn.btn-danger,
    [data-theme="dark"] .modal-warning-btn--danger,
    [data-theme="dark"] .modal-warning-btn--confirm,
    [data-theme="dark"] #deleteSelected,
    [data-theme="dark"] #deleteBtn {
      background: #7f1d1d !important;
      color: #fff !important;
      border-color: transparent !important;
      box-shadow: 0 8px 20px rgba(127,29,29,0.14);
    }
  </style>

  <style>
    /* Dark mode overrides for common Tailwind classes used in forms and panels */
    [data-theme="dark"] .bg-gray-50 {
      background-color: var(--bg-secondary) !important;
    }
    [data-theme="dark"] .text-gray-700 {
      color: var(--text-primary) !important;
    }
    [data-theme="dark"] .border-gray-200 {
      border-color: var(--border-color) !important;
    }
    
    [data-theme="dark"] .border-gray-300 {
      border-color: #6b7280 !important;
    }
    
    [data-theme="dark"] .bg-gradient-to-br {
      border-color: #4b5563 !important;
    }
    
    /* Bootstrap text utilities - Dark Mode */
    [data-theme="dark"] .text-muted {
      color: #9ca3af !important;
    }
    
    [data-theme="dark"] .text-white {
      color: #ffffff !important;
    }
    
    [data-theme="dark"] .text-dark {
      color: #1f2937 !important;
    }
    
    /* Bootstrap background utilities */
    [data-theme="dark"] .bg-light {
      background-color: #374151 !important;
      color: #f9fafb !important;
    }
    
    [data-theme="dark"] .bg-dark {
      background-color: #111827 !important;
      color: #f9fafb !important;
    }
    
    /* Container and spacing utilities */
    [data-theme="dark"] .container,
    [data-theme="dark"] .container-fluid {
      color: #f9fafb !important;
    }
  </style>

  <style>
    /* ========================================
       COMPREHENSIVE MODAL DARK MODE SUPPORT
       Targets all modals using Tailwind inline classes
       ======================================== */
    
    /* All modal backdrop overlays */
    [data-theme="dark"] .fixed.inset-0.bg-black\/40,
    [data-theme="dark"] .fixed.inset-0.bg-black\/50,
    [data-theme="dark"] [class*="bg-black/"] {
      background-color: rgba(0, 0, 0, 0.7) !important;
    }
    
    /* All modal content panels (white backgrounds) */
    [data-theme="dark"] .bg-white.rounded-lg,
    [data-theme="dark"] .bg-white.rounded,
    [data-theme="dark"] .bg-white.rounded-md,
    [data-theme="dark"] .bg-white.rounded-xl,
    [data-theme="dark"] div[id*="Modal"] .bg-white,
    [data-theme="dark"] div[id*="modal"] .bg-white,
    [data-theme="dark"] div[id*="Modal"] > div.bg-white,
    [data-theme="dark"] div[id*="modal"] > div.bg-white {
      background-color: #374151 !important;
      color: #f9fafb !important;
      border: 1px solid #4b5563 !important;
    }
    
    /* Ensure direct child divs of modals also get dark background */
    [data-theme="dark"] div[id*="Modal"] > .bg-white.rounded-lg.shadow-lg,
    [data-theme="dark"] div[id*="modal"] > .bg-white.rounded-lg.shadow-lg,
    [data-theme="dark"] div[id*="Modal"] > .bg-white.rounded-lg.shadow,
    [data-theme="dark"] div[id*="modal"] > .bg-white.rounded-lg.shadow {
      background-color: #374151 !important;
      color: #f9fafb !important;
      border: 1px solid #4b5563 !important;
    }
    
    /* Modal shadow improvements in dark mode */
    [data-theme="dark"] .shadow-lg,
    [data-theme="dark"] .shadow-xl {
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6) !important;
    }
    
    /* Modal headers with gradient backgrounds */
    [data-theme="dark"] .bg-gradient-to-r,
    [data-theme="dark"] .bg-gradient-to-br {
      background: linear-gradient(to bottom right, #2563eb, #7c3aed) !important;
      border-bottom: 1px solid #4b5563 !important;
    }
    
    /* Modal close buttons (X) */
    [data-theme="dark"] button.text-gray-500,
    [data-theme="dark"] .text-gray-500.text-xl {
      color: #e5e7eb !important;
    }
    
    [data-theme="dark"] button.text-gray-500:hover,
    [data-theme="dark"] .text-gray-500:hover {
      color: #f9fafb !important;
    }
    
    /* Modal section headers (h3, h4) */
    [data-theme="dark"] div[id*="Modal"] h3,
    [data-theme="dark"] div[id*="modal"] h3,
    [data-theme="dark"] div[id*="Modal"] h4,
    [data-theme="dark"] div[id*="modal"] h4 {
      color: #f9fafb !important;
    }
    
    /* Modal text labels and content */
    [data-theme="dark"] div[id*="Modal"] strong,
    [data-theme="dark"] div[id*="modal"] strong,
    [data-theme="dark"] div[id*="Modal"] label,
    [data-theme="dark"] div[id*="modal"] label {
      color: #e5e7eb !important;
    }
    
    /* Modal text content (divs, spans, paragraphs) */
    [data-theme="dark"] div[id*="Modal"] div,
    [data-theme="dark"] div[id*="modal"] div,
    [data-theme="dark"] div[id*="Modal"] p,
    [data-theme="dark"] div[id*="modal"] p,
    [data-theme="dark"] div[id*="Modal"] span,
    [data-theme="dark"] div[id*="modal"] span {
      color: #f9fafb !important;
    }
    
    /* Modal gray text utilities */
    [data-theme="dark"] div[id*="Modal"] .text-gray-600,
    [data-theme="dark"] div[id*="modal"] .text-gray-600,
    [data-theme="dark"] div[id*="Modal"] .text-sm.text-gray-600,
    [data-theme="dark"] div[id*="modal"] .text-sm.text-gray-600 {
      color: #d1d5db !important;
    }
    
    /* Modal form inputs, selects, textareas */
    [data-theme="dark"] div[id*="Modal"] input[type="text"],
    [data-theme="dark"] div[id*="modal"] input[type="text"],
    [data-theme="dark"] div[id*="Modal"] input[type="number"],
    [data-theme="dark"] div[id*="modal"] input[type="number"],
    [data-theme="dark"] div[id*="Modal"] input[type="email"],
    [data-theme="dark"] div[id*="modal"] input[type="email"],
    [data-theme="dark"] div[id*="Modal"] select,
    [data-theme="dark"] div[id*="modal"] select,
    [data-theme="dark"] div[id*="Modal"] textarea,
    [data-theme="dark"] div[id*="modal"] textarea {
      background-color: #1f2937 !important;
      color: #f9fafb !important;
      border-color: #6b7280 !important;
    }
    
    [data-theme="dark"] div[id*="Modal"] input:focus,
    [data-theme="dark"] div[id*="modal"] input:focus,
    [data-theme="dark"] div[id*="Modal"] select:focus,
    [data-theme="dark"] div[id*="modal"] select:focus,
    [data-theme="dark"] div[id*="Modal"] textarea:focus,
    [data-theme="dark"] div[id*="modal"] textarea:focus {
      background-color: #111827 !important;
      border-color: #60a5fa !important;
      box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1) !important;
    }
    
    /* Modal checkboxes */
    [data-theme="dark"] div[id*="Modal"] input[type="checkbox"],
    [data-theme="dark"] div[id*="modal"] input[type="checkbox"] {
      background-color: #374151 !important;
      border-color: #6b7280 !important;
    }
    
    [data-theme="dark"] div[id*="Modal"] input[type="checkbox"]:checked,
    [data-theme="dark"] div[id*="modal"] input[type="checkbox"]:checked {
      background-color: #0ea5e9 !important;
      border-color: #0ea5e9 !important;
    }
    
    /* Modal video/canvas (for QR scanner) */
    [data-theme="dark"] div[id*="Modal"] video,
    [data-theme="dark"] div[id*="modal"] video,
    [data-theme="dark"] div[id*="Modal"] canvas,
    [data-theme="dark"] div[id*="modal"] canvas {
      border: 2px solid #4b5563 !important;
      border-radius: 8px;
      background-color: #111827 !important;
    }
    
    /* Modal buttons - preserve their original colors */
    [data-theme="dark"] div[id*="Modal"] button.bg-sky-600,
    [data-theme="dark"] div[id*="modal"] button.bg-sky-600 {
      background-color: #0ea5e9 !important;
      color: white !important;
    }
    
    [data-theme="dark"] div[id*="Modal"] button.bg-red-600,
    [data-theme="dark"] div[id*="modal"] button.bg-red-600 {
      background-color: #dc2626 !important;
      color: white !important;
    }
    
    [data-theme="dark"] div[id*="Modal"] button.bg-emerald-600,
    [data-theme="dark"] div[id*="modal"] button.bg-emerald-600 {
      background-color: #059669 !important;
      color: white !important;
    }
    
    /* Modal secondary/gray buttons */
    [data-theme="dark"] div[id*="Modal"] button.bg-gray-200,
    [data-theme="dark"] div[id*="modal"] button.bg-gray-200,
    [data-theme="dark"] div[id*="Modal"] button.border.rounded,
    [data-theme="dark"] div[id*="modal"] button.border.rounded {
      background-color: #4b5563 !important;
      color: #e5e7eb !important;
      border-color: #6b7280 !important;
    }
    
    [data-theme="dark"] div[id*="Modal"] button.bg-gray-200:hover,
    [data-theme="dark"] div[id*="modal"] button.bg-gray-200:hover,
    [data-theme="dark"] div[id*="Modal"] button.border.rounded:hover,
    [data-theme="dark"] div[id*="modal"] button.border.rounded:hover {
      background-color: #374151 !important;
    }
    
    /* Modal tables (if any) */
    [data-theme="dark"] div[id*="Modal"] table,
    [data-theme="dark"] div[id*="modal"] table {
      background-color: #1f2937 !important;
      border-color: #4b5563 !important;
    }
    
    [data-theme="dark"] div[id*="Modal"] table th,
    [data-theme="dark"] div[id*="modal"] table th {
      background-color: #374151 !important;
      color: #f9fafb !important;
      border-color: #6b7280 !important;
    }
    
    [data-theme="dark"] div[id*="Modal"] table td,
    [data-theme="dark"] div[id*="modal"] table td {
      border-color: #4b5563 !important;
      color: #f9fafb !important;
    }
    
    [data-theme="dark"] div[id*="Modal"] table tbody tr:hover,
    [data-theme="dark"] div[id*="modal"] table tbody tr:hover {
      background-color: #374151 !important;
    }
    
    /* Modal info/warning boxes (colored backgrounds) */
    [data-theme="dark"] div[id*="Modal"] .bg-blue-50,
    [data-theme="dark"] div[id*="modal"] .bg-blue-50 {
      background-color: #1e3a5f !important;
      color: #93c5fd !important;
      border-color: #2563eb !important;
    }
    
    [data-theme="dark"] div[id*="Modal"] .bg-yellow-50,
    [data-theme="dark"] div[id*="modal"] .bg-yellow-50 {
      background-color: #78350f !important;
      color: #fef3c7 !important;
      border-color: #f59e0b !important;
    }
    
    [data-theme="dark"] div[id*="Modal"] .bg-green-50,
    [data-theme="dark"] div[id*="modal"] .bg-green-50 {
      background-color: #064e3b !important;
      color: #d1fae5 !important;
      border-color: #059669 !important;
    }
    
    [data-theme="dark"] div[id*="Modal"] .bg-red-50,
    [data-theme="dark"] div[id*="modal"] .bg-red-50 {
      background-color: #7f1d1d !important;
      color: #fecaca !important;
      border-color: #dc2626 !important;
    }
    
    /* Modal gray backgrounds (for info sections) */
    [data-theme="dark"] div[id*="Modal"] .bg-gray-50,
    [data-theme="dark"] div[id*="modal"] .bg-gray-50,
    [data-theme="dark"] div[id*="Modal"] .bg-gray-100,
    [data-theme="dark"] div[id*="modal"] .bg-gray-100 {
      background-color: #1f2937 !important;
      color: #e5e7eb !important;
      border-color: #4b5563 !important;
    }
    
    /* Modal text color utilities */
    [data-theme="dark"] div[id*="Modal"] .text-blue-600,
    [data-theme="dark"] div[id*="modal"] .text-blue-600 {
      color: #60a5fa !important;
    }
    
    [data-theme="dark"] div[id*="Modal"] .text-yellow-800,
    [data-theme="dark"] div[id*="modal"] .text-yellow-800 {
      color: #fef3c7 !important;
    }
    
    [data-theme="dark"] div[id*="Modal"] .text-green-800,
    [data-theme="dark"] div[id*="modal"] .text-green-800 {
      color: #d1fae5 !important;
    }
    
    [data-theme="dark"] div[id*="Modal"] .text-red-800,
    [data-theme="dark"] div[id*="modal"] .text-red-800 {
      color: #fecaca !important;
    }
    
    /* Modal border utilities */
    [data-theme="dark"] div[id*="Modal"] .border-yellow-300,
    [data-theme="dark"] div[id*="modal"] .border-yellow-300 {
      border-color: #f59e0b !important;
    }
    
    /* Global wait overlay dark mode */
    [data-theme="dark"] #globalWait > div {
      background-color: #374151 !important;
      color: #f9fafb !important;
      border: 1px solid #4b5563 !important;
    }
    
    [data-theme="dark"] #globalWait .text-gray-400 {
      color: #9ca3af !important;
    }
    
    /* Specific modals by ID for extra coverage */
    [data-theme="dark"] #summaryModal > div,
    [data-theme="dark"] #repeatMappingModal > div,
    [data-theme="dark"] #afmWarningModal > div,
    [data-theme="dark"] #addModal > div,
    [data-theme="dark"] #editModal > div,
    [data-theme="dark"] #settingsModal > div,
    [data-theme="dark"] #qrCameraModal > div,
    [data-theme="dark"] #qrRemoteModal > div,
    [data-theme="dark"] #userDetailModal > div,
    [data-theme="dark"] #groupDetailModal > div,
    [data-theme="dark"] #deleteModal > div,
    [data-theme="dark"] #confirmDeleteModal > div,
    [data-theme="dark"] #issuesModal > div,
    [data-theme="dark"] #deleteCategoryModal > div,
    [data-theme="dark"] #receiptsModal > div,
    [data-theme="dark"] #credentialDeleteModal > div,
    [data-theme="dark"] #credentialPermissionDeniedModal > div,
    [data-theme="dark"] #dataBackupRestoreModal > div {
      background-color: #374151 !important;
      color: #f9fafb !important;
      border: 1px solid #4b5563 !important;
    }
    
    /* ========================================
       MODAL TAB BUTTONS (e.g., settingsModal)
       ======================================== */
    
    /* Tab buttons in modals - inactive state */
    [data-theme="dark"] .tab-inactive,
    [data-theme="dark"] button.tab-inactive {
      background-color: #4b5563 !important;
      color: #9ca3af !important;
      border-color: #6b7280 !important;
    }
    
    [data-theme="dark"] .tab-inactive:hover,
    [data-theme="dark"] button.tab-inactive:hover {
      background-color: #374151 !important;
      color: #e5e7eb !important;
    }
    
    /* Tab buttons in modals - active state */
    [data-theme="dark"] .tab-active,
    [data-theme="dark"] button.tab-active {
      background-color: #0ea5e9 !important;
      color: white !important;
      border-color: #0ea5e9 !important;
      box-shadow: 0 2px 8px rgba(14, 165, 233, 0.3) !important;
    }
    
    /* Light mode tab styles for consistency */
    .tab-inactive {
      background-color: #f3f4f6;
      color: #6b7280;
      border: 1px solid #d1d5db;
    }
    
    .tab-inactive:hover {
      background-color: #e5e7eb;
      color: #374151;
    }
    
    .tab-active {
      background-color: #0ea5e9;
      color: white;
      border: 1px solid #0ea5e9;
      box-shadow: 0 2px 8px rgba(14, 165, 233, 0.2);
    }
  </style>
    
  {% block head_extra %}{% endblock %}
</head>
<body>
  <div class="container">
    <header class="mb-6">
      <div class="layout-header flex items-center justify-between">
        <div class="layout-header__brand">
          <a href="{{ url_for('home') }}" class="inline-block">
            <img src="/icons/scanmydata_logo_3000w.png" alt="ScanmyData Logo" class="logo-img logo-light">
            <img src="/icons/scanmydata_logo_dark_3000w.png" alt="ScanmyData Logo" class="logo-img logo-dark">
          </a>
        </div>

        <div class="layout-header__right flex flex-col items-end gap-2">
          <!-- 1η γραμμή: Menu buttons + Active credential -->
          <div class="layout-header__top-row flex items-center gap-4">
            <nav class="layout-header__nav flex gap-3 items-center">
              <a href="{{ url_for('fetch') }}" class="px-3 py-2 rounded-md text-sm font-medium {% if active_page=='fetch' %}bg-sky-600 text-white{% else %}bg-white border hover:bg-gray-100 text-gray-700{% endif %}">📥 Λήψη Παραστατικών</a>
              <a href="{{ url_for('search') }}" class="px-3 py-2 rounded-md text-sm font-medium {% if active_page=='search' %}bg-sky-600 text-white{% else %}bg-white border hover:bg-gray-100 text-gray-700{% endif %}">🔍 Αναζήτηση MARK</a>
              <a href="{{ url_for('credentials') }}" class="px-3 py-2 rounded-md text-sm font-medium {% if active_page=='credentials' %}bg-sky-600 text-white{% else %}bg-white border hover:bg-gray-100 text-gray-700{% endif %}">🔐 Credentials</a>
              {% if current_user.is_authenticated and (current_user.is_admin or current_user.id == ADMIN_USER_ID) %}
                <a href="{{ url_for('admin_dashboard') }}" class="px-3 py-2 rounded-md text-sm font-medium bg-red-600 text-white hover:bg-red-700">⚙️ Admin</a>
              {% endif %}
            </nav>

            <!-- Active credential badge moved to second row -->
            <div class="ml-4 flex items-center gap-3">
              <!-- Dark mode toggle -->
              <label class="theme-switch" title="Σκούρο θέμα: Ενεργοποιήστε για να μειώσετε την κόπωση των ματιών σε συνθήκες χαμηλού φωτισμού">
                <input type="checkbox" id="themeToggle">
                <span class="theme-slider"></span>
              </label>
              
              <button id="sideMenuToggle" class="px-3 py-1 rounded text-sm bg-white border hover:bg-gray-100 text-gray-700">☰ Μενού</button>
              {% if current_user.is_authenticated %}
                <span class="text-sm text-gray-700 ml-2">{{ display_username or current_user.username }}</span>
              {% endif %}
            </div>
          </div>

          <!-- 2η γραμμή: Ενεργός πελάτης + Fiscal year selector (only for logged in users) -->
          {% if current_user.is_authenticated %}
          <div class="layout-header__year-row flex items-center gap-4 w-max">
            <div class="layout-header__active-customer flex items-center gap-2">
              <span class="text-sm text-gray-500">Ενεργός πελάτης:</span>
              {% if active_credential %}
                {% if active_credential_vat %}
                  <span class="px-3 py-1 rounded-full text-sm font-medium bg-sky-600 text-white">{{ active_credential }} ({{ active_credential_vat }})</span>
                {% else %}
                  <span class="px-3 py-1 rounded-full text-sm font-medium bg-sky-600 text-white">{{ active_credential }}</span>
                {% endif %}
              {% else %}
                <span class="px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-600">—</span>
              {% endif %}
            </div>

            <div class="layout-header__active-group flex items-center gap-2">
              <span class="text-sm text-gray-500">Ενεργή ομάδα:</span>
              {% if active_group %}
                <span class="px-3 py-1 rounded-full text-sm font-medium bg-emerald-600 text-white">{{ active_group }}</span>
              {% else %}
                <span class="px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-600">—</span>
              {% endif %}
            </div>

            <label for="fiscalYearSelect" class="text-sm text-gray-500">Χρήση:</label>
            <select id="fiscalYearSelect" class="px-2 py-1 rounded border text-sm"></select>
            <button id="fiscalYearSaveBtn" class="px-3 py-1 rounded bg-sky-600 text-white text-sm">Αποθήκευση</button>
            <span id="fiscalYearMsg" class="text-sm text-gray-500 ml-2"></span>
          </div>
          {% endif %}
        </div>
      </div>
    </header>

    <!-- Side Menu (toggleable) -->
    <div id="sideMenu" class="fixed inset-y-0 right-0 w-72 bg-white shadow-lg z-50 overflow-y-auto transform translate-x-full transition-transform duration-300 ease-in-out">
      <div class="p-6 space-y-6">
        <!-- Header -->
        <div class="flex justify-between items-center">
          <h2 class="text-lg font-semibold text-gray-900">Μενού</h2>
          <button id="sideMenuClose" class="text-2xl text-gray-500 hover:text-gray-700">×</button>
        </div>

        <!-- User Info -->
        {% if current_user.is_authenticated %}
        <div class="border-b pb-4">
          <div class="mb-2 flex items-center justify-between gap-2">
            <div>
              <p class="text-sm font-medium text-gray-700">Χρήστης</p>
              <p class="text-lg font-semibold text-sky-600">{{ current_user.username }}</p>
            </div>
            <a href="{{ url_for('auth.account_settings') }}" class="inline-flex items-center justify-center w-9 h-9 rounded-full border border-gray-200 text-gray-500 hover:text-gray-700 hover:border-gray-300" title="Ρυθμίσεις λογαριασμού" aria-label="Ρυθμίσεις λογαριασμού">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.573-1.065z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
            </a>
          </div>
          <a href="{{ url_for('auth.logout') }}" class="block px-4 py-2 rounded text-sm bg-red-100 text-red-700 hover:bg-red-200 text-center side-logout">Αποσύνδεση</a>
        </div>

        <!-- Groups Selector -->
        <div class="border-b pb-4">
          <p class="text-sm font-medium text-gray-700 mb-3">Ομάδες</p>
          <div id="groupsList" class="space-y-2 max-h-64 overflow-y-auto"></div>
          <a href="{{ url_for('auth.list_groups') }}" class="block mt-3 px-4 py-2 rounded text-sm bg-blue-100 text-blue-700 hover:bg-blue-200 text-center side-manage-groups">Διαχείριση ομάδων</a>
        </div>

        <!-- Quick Links -->
        <div>
          <p class="text-sm font-medium text-gray-700 mb-3">Σύνδεσμοι</p>
            <div class="space-y-2">
            <a href="{{ url_for('home') }}" class="block px-3 py-2 rounded text-sm hover:bg-gray-100 text-gray-700">🏠 Αρχική</a>
            <a href="{{ url_for('fetch') }}" class="block px-3 py-2 rounded text-sm hover:bg-gray-100 text-gray-700">📥 Λήψη Παραστατικών</a>
            <a href="{{ url_for('search') }}" class="block px-3 py-2 rounded text-sm hover:bg-gray-100 text-gray-700">🔍 Αναζήτηση</a>
            <a href="{{ url_for('credentials') }}" class="block px-3 py-2 rounded text-sm hover:bg-gray-100 text-gray-700">🔐 Credentials</a>
          </div>
        </div>
        {% else %}
        <div class="space-y-2">
          <a href="{{ url_for('auth.login') }}" class="block px-4 py-2 rounded text-sm bg-sky-600 text-white hover:bg-sky-700 text-center">Σύνδεση</a>
          <a href="{{ url_for('auth.signup') }}" class="block px-4 py-2 rounded text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 text-center">Δημιουργία λογαριασμού</a>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Side Menu Overlay (uses backdrop blur) -->
    <div id="sideMenuOverlay" class="fixed inset-0 bg-black/10 backdrop-blur-sm opacity-0 invisible z-40 transition-all duration-300"></div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="space-y-2 mb-4" id="flashContainer">
          {% for cat, msg in messages %}
            {% set normalized = (cat or '')|lower %}
            {% if normalized in ['error', 'danger'] %}
              {% set flash_class = 'flash-error' %}
            {% elif normalized in ['warning'] %}
              {% set flash_class = 'flash-warning' %}
            {% elif normalized in ['info'] %}
              {% set flash_class = 'flash-info' %}
            {% else %}
              {% set flash_class = 'flash-success' %}
            {% endif %}
            <div class="flash-banner {{ flash_class }}" role="alert" data-flash data-ttl="6000">{{ msg|safe }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
    
    <!-- FOOTER -->
    <footer class="mt-8 pt-6 pb-4 border-t border-gray-200 dark:border-gray-700">
      <div class="text-center text-sm text-gray-500 dark:text-gray-400">
        <p class="mb-2">
          © {{ now.year if now else 2025 }} ScanmyData - Σάρωση & Καταχώρηση
        </p>
        <p class="flex items-center justify-center gap-4 flex-wrap">
          <a href="/terms" class="text-sky-600 dark:text-sky-400 hover:underline">Όροι Χρήσης</a>
          <span class="text-gray-300 dark:text-gray-600">|</span>
          <a href="/privacy" class="text-sky-600 dark:text-sky-400 hover:underline">Πολιτική Απορρήτου</a>
          <span class="text-gray-300 dark:text-gray-600">|</span>
          <span>GDPR Compliant</span>
        </p>
      </div>
    </footer>
  </div>

  <!-- WAIT OVERLAY (global) -->
  <div id="globalWait"
       class="fixed inset-0 z-[100000] hidden items-center justify-center"
       style="background:rgba(0,0,0,.4);display:none;">
    <div class="bg-white rounded-lg shadow-lg px-6 py-5 text-center">
      <div class="text-base font-medium mb-2">Παρακαλώ περιμένετε…</div>
      <div class="text-gray-400 animate-pulse" aria-hidden="true">● ● ●</div>
    </div>
  </div>

  <!-- COOKIE CONSENT BANNER (GDPR) -->
  <div id="cookieConsent" class="fixed bottom-0 left-0 right-0 bg-gray-900 text-white p-6 shadow-2xl z-[99999]" style="display:none;">
    <div class="max-w-6xl mx-auto">
      <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
        <div class="flex-1">
          <h3 class="text-lg font-semibold mb-2">🍪 Cookies & Προστασία Δεδομένων</h3>
          <p class="text-sm text-gray-300 mb-2">
            Χρησιμοποιούμε απαραίτητα cookies για τη λειτουργία της υπηρεσίας και την ασφάλεια του λογαριασμού σας. 
            Επίσης συλλέγουμε δεδομένα χρήσης (IP addresses, logs) σύμφωνα με τον GDPR.
          </p>
          <p class="text-xs text-gray-400">
            Με τη χρήση της πλατφόρμας αποδέχεστε τους 
            <a href="/terms" class="text-sky-400 hover:text-sky-300 underline">Όρους Χρήσης</a> και την 
            <a href="/privacy" class="text-sky-400 hover:text-sky-300 underline">Πολιτική Απορρήτου</a>.
          </p>
        </div>
        <div class="flex flex-col sm:flex-row gap-3 shrink-0">
          <button id="cookieSettings" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm font-medium transition">
            ⚙️ Ρυθμίσεις
          </button>
          <button id="cookieAccept" class="px-6 py-2 bg-sky-600 hover:bg-sky-700 rounded-lg text-sm font-medium transition">
            ✓ Αποδοχή
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- COOKIE SETTINGS MODAL -->
  <div id="cookieSettingsModal" class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-[100000]" style="display:none;">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Ρυθμίσεις Cookies</h2>
          <button id="cookieSettingsClose" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl">×</button>
        </div>
        
        <div class="space-y-4">
          <!-- Necessary Cookies -->
          <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
            <div class="flex items-center justify-between mb-2">
              <h3 class="font-semibold text-gray-900 dark:text-white">Απαραίτητα Cookies</h3>
              <span class="text-sm px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-full text-gray-700 dark:text-gray-300">Πάντα Ενεργά</span>
            </div>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Αυτά τα cookies είναι απαραίτητα για τη λειτουργία της πλατφόρμας (authentication, session management). 
              Δεν μπορούν να απενεργοποιηθούν.
            </p>
          </div>

          <!-- Functional Cookies -->
          <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
            <div class="flex items-center justify-between mb-2">
              <h3 class="font-semibold text-gray-900 dark:text-white">Λειτουργικά Cookies</h3>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="functionalCookies" class="sr-only peer" checked>
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-sky-300 dark:peer-focus:ring-sky-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-sky-600"></div>
              </label>
            </div>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Αποθήκευση προτιμήσεων χρήστη (dark mode, επιλεγμένη ομάδα, μέγεθος γραμματοσειράς).
            </p>
          </div>

          <!-- Analytics Cookies -->
          <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
            <div class="flex items-center justify-between mb-2">
              <h3 class="font-semibold text-gray-900 dark:text-white">Cookies Ανάλυσης</h3>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="analyticsCookies" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-sky-300 dark:peer-focus:ring-sky-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-sky-600"></div>
              </label>
            </div>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Συλλογή στατιστικών χρήσης για βελτίωση της πλατφόρμας. Περιλαμβάνει IP address και user activity logs.
            </p>
          </div>
        </div>

        <div class="mt-6 flex flex-col sm:flex-row gap-3">
          <button id="cookieRejectAll" class="flex-1 px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-lg font-medium text-gray-900 dark:text-white transition">
            Απόρριψη Όλων
          </button>
          <button id="cookieSaveSettings" class="flex-1 px-4 py-2 bg-sky-600 hover:bg-sky-700 rounded-lg font-medium text-white transition">
            Αποθήκευση Ρυθμίσεων
          </button>
          <button id="cookieAcceptAll" class="flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-medium text-white transition">
            Αποδοχή Όλων
          </button>
        </div>

        <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
          <p class="text-xs text-gray-500 dark:text-gray-400">
            Περισσότερες πληροφορίες στην <a href="/privacy" class="text-sky-600 dark:text-sky-400 hover:underline">Πολιτική Απορρήτου</a> 
            και τους <a href="/terms" class="text-sky-600 dark:text-sky-400 hover:underline">Όρους Χρήσης</a>.
          </p>
        </div>
      </div>
    </div>
  </div>

  {% block scripts %}{% endblock %}

  <script>
    // ============================================================================
    // COOKIE CONSENT MANAGEMENT (GDPR)
    // ============================================================================
    (function() {
      const COOKIE_CONSENT_KEY = 'cookieConsent';
      const COOKIE_PREFERENCES_KEY = 'cookiePreferences';
      
      function getCookieConsent() {
        try {
          return localStorage.getItem(COOKIE_CONSENT_KEY);
        } catch (e) {
          return null;
        }
      }
      
      function setCookieConsent(value) {
        try {
          localStorage.setItem(COOKIE_CONSENT_KEY, value);
        } catch (e) {
          console.error('Failed to save cookie consent:', e);
        }
      }
      
      function getCookiePreferences() {
        try {
          const prefs = localStorage.getItem(COOKIE_PREFERENCES_KEY);
          return prefs ? JSON.parse(prefs) : { functional: true, analytics: false };
        } catch (e) {
          return { functional: true, analytics: false };
        }
      }
      
      function setCookiePreferences(prefs) {
        try {
          localStorage.setItem(COOKIE_PREFERENCES_KEY, JSON.stringify(prefs));
        } catch (e) {
          console.error('Failed to save cookie preferences:', e);
        }
      }
      
      function showCookieBanner() {
        const banner = document.getElementById('cookieConsent');
        if (banner) banner.style.display = 'block';
      }
      
      function hideCookieBanner() {
        const banner = document.getElementById('cookieConsent');
        if (banner) banner.style.display = 'none';
      }
      
      function showCookieSettings() {
        const modal = document.getElementById('cookieSettingsModal');
        if (modal) {
          modal.style.display = 'flex';
          
          // Load current preferences
          const prefs = getCookiePreferences();
          const functionalCheckbox = document.getElementById('functionalCookies');
          const analyticsCheckbox = document.getElementById('analyticsCookies');
          
          if (functionalCheckbox) functionalCheckbox.checked = prefs.functional !== false;
          if (analyticsCheckbox) analyticsCheckbox.checked = prefs.analytics === true;
        }
      }
      
      function hideCookieSettings() {
        const modal = document.getElementById('cookieSettingsModal');
        if (modal) modal.style.display = 'none';
      }
      
      function acceptAllCookies() {
        setCookieConsent('accepted');
        setCookiePreferences({ functional: true, analytics: true });
        hideCookieBanner();
        hideCookieSettings();
      }
      
      function rejectAllCookies() {
        setCookieConsent('rejected');
        setCookiePreferences({ functional: false, analytics: false });
        hideCookieBanner();
        hideCookieSettings();
      }
      
      function saveCustomSettings() {
        const functionalCheckbox = document.getElementById('functionalCookies');
        const analyticsCheckbox = document.getElementById('analyticsCookies');
        
        const prefs = {
          functional: functionalCheckbox ? functionalCheckbox.checked : true,
          analytics: analyticsCheckbox ? analyticsCheckbox.checked : false
        };
        
        setCookieConsent('custom');
        setCookiePreferences(prefs);
        hideCookieBanner();
        hideCookieSettings();
      }
      
      // Initialize on page load
      document.addEventListener('DOMContentLoaded', function() {
        const consent = getCookieConsent();
        
        // Show banner if no consent given
        if (!consent) {
          // Delay showing banner by 1 second for better UX
          setTimeout(showCookieBanner, 1000);
        }
        
        // Attach event listeners
        const acceptBtn = document.getElementById('cookieAccept');
        const settingsBtn = document.getElementById('cookieSettings');
        const settingsCloseBtn = document.getElementById('cookieSettingsClose');
        const rejectAllBtn = document.getElementById('cookieRejectAll');
        const saveSettingsBtn = document.getElementById('cookieSaveSettings');
        const acceptAllBtn = document.getElementById('cookieAcceptAll');
        
        if (acceptBtn) acceptBtn.addEventListener('click', acceptAllCookies);
        if (settingsBtn) settingsBtn.addEventListener('click', showCookieSettings);
        if (settingsCloseBtn) settingsCloseBtn.addEventListener('click', hideCookieSettings);
        if (rejectAllBtn) rejectAllBtn.addEventListener('click', rejectAllCookies);
        if (saveSettingsBtn) saveSettingsBtn.addEventListener('click', saveCustomSettings);
        if (acceptAllBtn) acceptAllBtn.addEventListener('click', acceptAllCookies);
        
        // Close modal on outside click
        const modal = document.getElementById('cookieSettingsModal');
        if (modal) {
          modal.addEventListener('click', function(e) {
            if (e.target === modal) {
              hideCookieSettings();
            }
          });
        }
      });
      
      // Expose function to check if analytics are enabled (for conditional loading)
      window.areAnalyticsEnabled = function() {
        const consent = getCookieConsent();
        if (!consent) return false;
        if (consent === 'rejected') return false;
        if (consent === 'accepted') return true;
        const prefs = getCookiePreferences();
        return prefs.analytics === true;
      };
    })();
    
    // ============================================================================
    // EXISTING SCRIPTS
    // ============================================================================
    // Dismissable + auto-close (5-6s) ONLY for .flash-banner
    document.addEventListener('DOMContentLoaded', function(){
      const AUTO_TTL = 6000; // ms

      function makeDismissable(el){
        if (!el || el.dataset.dismissable === '1') return;
        el.dataset.dismissable = '1';

        // add small × button
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.setAttribute('aria-label','Close');
        btn.textContent = '×';
        btn.style.cssText = 'position:absolute;top:.4rem;right:.5rem;line-height:1;font-size:20px;opacity:.75;cursor:pointer;background:transparent;border:0;padding:0;z-index:1';

        const cs = getComputedStyle(el);
        if (cs.position === 'static') el.style.position = 'relative';
        if (!el.style.paddingRight) {
          const pr = parseFloat(cs.paddingRight || '0');
          if (pr < 22) el.style.paddingRight = '28px';
        }

        btn.addEventListener('click', ()=> { try{ el.remove(); }catch(_){ } });
        el.appendChild(btn);

        const ttlAttr = parseInt(el.getAttribute('data-ttl') || AUTO_TTL, 10);
        if (ttlAttr > 0) setTimeout(()=>{ try{ el.remove(); }catch(_){ } }, ttlAttr);
      }

      document.querySelectorAll('.flash-banner').forEach(makeDismissable);

      // Also observe for dynamically added flashes
      const mo = new MutationObserver(muts=>{
        muts.forEach(m=> m.addedNodes && m.addedNodes.forEach(n=>{
          if (n.nodeType===1) {
            if (n.matches && n.matches('.flash-banner')) makeDismissable(n);
            n.querySelectorAll && n.querySelectorAll('.flash-banner').forEach(makeDismissable);
          }
        }));
      });
      mo.observe(document.body, { childList:true, subtree:true });

      // Support existing close buttons if present
      document.addEventListener('click', function(e){
        const b = e.target.closest && e.target.closest('[data-dismiss="flash"], .btn-close, .close');
        if (!b) return;
        const host = b.closest('.flash-banner') || b.parentElement;
        if (host) { e.preventDefault(); try{ host.remove(); }catch(_){ } }
      }, true);
    });
  </script>

  <!-- ✅ Fiscal Year logic (ενσωμάτωση από την εκδοχή που «δούλευε τέλεια») -->
  <script>
    (function(){
      const thisYear = new Date().getFullYear();

      function populateFiscalSelect(selected){
        const sel = document.getElementById('fiscalYearSelect');
        if(!sel) return;
        sel.innerHTML = '';
        for(let y=thisYear-1; y<=thisYear+2; y++){
          const opt = document.createElement('option');
          opt.value = String(y);
          opt.textContent = String(y);
          if(Number(selected) === y) opt.selected = true;
          sel.appendChild(opt);
        }
      }

      async function loadFiscalYearIntoUi(){
        try{
          const r = await fetch('/get_fiscal_year', { credentials:'same-origin' });
          const j = await r.json();
          populateFiscalSelect(j.fiscal_year || thisYear);
          const msg = document.getElementById('fiscalYearMsg');
          if (msg) msg.textContent = j.fiscal_year ? `Ενεργό: ${j.fiscal_year}` : 'Δεν έχει οριστεί χρήση';
        } catch {
          populateFiscalSelect(thisYear);
          const msg = document.getElementById('fiscalYearMsg');
          if (msg) msg.textContent = 'Σφάλμα ανάγνωσης χρήσης';
        }
      }

      async function saveFiscalYear(e){
        e.preventDefault();
        const year = Number(document.getElementById('fiscalYearSelect').value);
        try{
          const r = await fetch('/set_fiscal_year', {
            method: 'POST',
            credentials: 'same-origin',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ fiscal_year: year })
          });
          const j = await r.json();
          if (j.success){
            location.reload(); // ξαναφορτώνουμε με τη νέα χρήση
          } else {
            const msg = document.getElementById('fiscalYearMsg');
            if (msg) msg.textContent = j.message || 'Αποτυχία αποθήκευσης χρήσης';
          }
        } catch {
          const msg = document.getElementById('fiscalYearMsg');
          if (msg) msg.textContent = 'Σφάλμα δικτύου';
        }
      }

      document.addEventListener('DOMContentLoaded', () => {
        loadFiscalYearIntoUi();
        const btn = document.getElementById('fiscalYearSaveBtn');
        if (btn) btn.addEventListener('click', saveFiscalYear);
      });
    })();
  </script>

  <script>
    (function(){
      const SCALE_MIN = 0.96;
      const SCALE_MAX = 1.18;
      const WIDTH_MIN = 360;
      const WIDTH_MAX = 1600;
      let lastType = null;
      let lastScale = null;
      let resizeTimer = null;

      function detectDeviceType(){
        const ua = (navigator.userAgent || '').toLowerCase();
        const width = window.innerWidth || document.documentElement.clientWidth || 0;
        if (width <= 768 || /mobile|android|iphone|ipod/.test(ua)) return 'mobile';
        if (width <= 1200 || /ipad|tablet/.test(ua)) return 'tablet';
        return 'desktop';
      }

      function assignBody(type){
        if (!document.body){
          document.addEventListener('DOMContentLoaded', () => assignBody(type), { once:true });
          return;
        }
        document.body.dataset.device = type;
      }

      function computeScale(width){
        const w = Math.min(Math.max(width || WIDTH_MIN, WIDTH_MIN), WIDTH_MAX);
        const ratio = (w - WIDTH_MIN) / (WIDTH_MAX - WIDTH_MIN);
        const scale = SCALE_MAX - ratio * (SCALE_MAX - SCALE_MIN);
        return Number(scale.toFixed(3));
      }

      function applyDeviceType(){
        const type = detectDeviceType();
        const width = window.innerWidth || document.documentElement.clientWidth || screen.width || WIDTH_MAX;
        const scale = computeScale(width);
        if (type !== lastType) {
          lastType = type;
          assignBody(type);
        }
        if (lastScale !== scale) {
          lastScale = scale;
          document.documentElement.style.setProperty('--device-font-scale', String(scale));
        }
      }

      function schedule(){
        if (resizeTimer){
          clearTimeout(resizeTimer);
        }
        resizeTimer = setTimeout(applyDeviceType, 90);
      }

      if (document.readyState === 'loading'){
        document.addEventListener('DOMContentLoaded', applyDeviceType, { once:true });
      } else {
        applyDeviceType();
      }

      window.addEventListener('resize', schedule);
      window.addEventListener('orientationchange', schedule);
      if (window.ResizeObserver){
        try {
          const ro = new ResizeObserver(() => schedule());
          ro.observe(document.documentElement);
        } catch(_){}
      }
    })();
  </script>

  <script>
    (function(){
      // ====== WAIT OVERLAY ======
      const waitEl = document.getElementById('globalWait');
      let waitCount = 0;
      let suspendWait = 0; // όταν >0, δεν θα εμφανίζεται το overlay

      function showWait(){ if(!waitEl || suspendWait>0) return; waitCount++; waitEl.style.display='flex'; }
      function hideWait(){ if(!waitEl) return; waitCount = Math.max(0, waitCount-1); if(!waitCount) waitEl.style.display='none'; }
      function forceHide(){ if(!waitEl) return; waitCount = 0; waitEl.style.display='none'; }
      function suspend(on){ suspendWait = Math.max(0, suspendWait + (on?1:-1)); if (suspendWait>0) forceHide(); }
      window.WaitOverlay = { show: showWait, hide: hideWait, suspend, forceHide };

      // Patch fetch (AJAX)
      const _fetch = window.fetch;

      function shouldSkipWait(args){
        try {
          const [input, init] = args || [];

          function readUrl(target){
            if (!target) return '';
            if (typeof target === 'string') return target;
            if (typeof Request !== 'undefined' && target instanceof Request) return target.url || '';
            if (typeof target.url === 'string') return target.url;
            return '';
          }

          function hasSkipHeader(options){
            if (!options || !options.headers) return false;
            const headers = options.headers;

            try {
              if (typeof headers.get === 'function'){
                const direct = headers.get('X-Wait-Overlay') || headers.get('x-wait-overlay');
                if (typeof direct === 'string' && direct.toLowerCase() === 'skip') return true;
              }
            } catch (_) {}

            if (headers && typeof headers === 'object'){
              const entries = Array.isArray(headers) ? headers : Object.entries(headers);
              for (const entry of entries){
                if (!entry) continue;
                let key, value;
                if (Array.isArray(entry)){
                  [key, value] = entry;
                } else {
                  key = entry[0];
                  value = entry[1];
                }
                if (typeof key === 'string' && key.toLowerCase() === 'x-wait-overlay'){
                  if (String(value).toLowerCase() === 'skip') return true;
                }
              }
            }
            return false;
          }

          const url = readUrl(input);
          if (url && /\/api\/qr\/remote\//.test(url)) return true;
          if (hasSkipHeader(init)) return true;
          if (input && typeof input === 'object'){
            const maybeRequestHeaders = input.headers;
            if (hasSkipHeader({ headers: maybeRequestHeaders })) return true;
          }
        } catch (_) {}
        return false;
      }

      window.fetch = async function(...args){
        const skip = shouldSkipWait(args);
        if (!skip) showWait();
        try { return await _fetch(...args); }
        finally { if (!skip) hideWait(); }
      };

      // Patch XHR (πιάνει jQuery/DataTables)
      const XHROpen = XMLHttpRequest.prototype.open;
      const XHRSend = XMLHttpRequest.prototype.send;
      XMLHttpRequest.prototype.open = function(...a){ this.__withWait = true; return XHROpen.apply(this,a); };
      XMLHttpRequest.prototype.send = function(...a){
        if (this.__withWait){ showWait(); this.addEventListener('loadend', hideWait, { once:true }); }
        return XHRSend.apply(this,a);
      };

      // Form submits (πλοήγηση)
      document.addEventListener('submit', function(){ showWait(); setTimeout(hideWait, 15000); }, true);

          
    // ====== WARNING MODALS INTEGRATION (Reload after ANY warning modal ack) ======
    (function(){
      const WARN_HOST_SELECTORS = [
        '#afmWarningModal', '#receiptWarn', '#receiptWarningModal', '#receiptWarning',
        '[id$="WarningModal"]', '.warning-modal', '[data-role="modal-warning"]'
      ];

      function isVisible(el){
        if(!el) return false;
        const st = window.getComputedStyle(el);
        return st.display!=='none' && st.visibility!=='hidden' && st.opacity!=='0';
      }
      function toggleWaitByWarnings(){
        try {
          const anyOpen = WARN_HOST_SELECTORS.some(sel => {
            const node = document.querySelector(sel);
            return node && isVisible(node);
          });
          if (window.WaitOverlay && typeof window.WaitOverlay.suspend === 'function') {
            window.WaitOverlay.suspend(anyOpen);
          }
        } catch(_) {}
      }
      const moWarn = new MutationObserver(toggleWaitByWarnings);
      moWarn.observe(document.documentElement, { attributes:true, childList:true, subtree:true });
      toggleWaitByWarnings();

      function closeModalHost(host){
        try {
          if (typeof bootstrap !== 'undefined' && host) {
            const inst = bootstrap.Modal.getOrCreateInstance(host);
            inst.hide();
            return;
          }
        } catch(_) {}
        try { host.style.display = 'none'; } catch(_){}
      }

      function isAckButton(el){
        if (!el) return false;
        if (el.id === 'afmModalConfirm' || el.id === 'receiptWarnOk') return true;
        if (el.matches && el.matches('[data-ack="1"], [data-role="warning-ack"], .js-warning-ack')) return true;
        const txt = (el.textContent || '').trim().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
        return (txt === 'το καταλαβα' || txt === 'καταλαβα' || txt === 'ενταξει' || txt === 'ok');
      }

      function findWarningHost(el){
        if (!el || !el.closest) return null;
        for (const sel of WARN_HOST_SELECTORS){
          const host = el.closest(sel);
          if (host) return host;
        }
        return null;
      }

      document.addEventListener('click', function(ev){
        const btn = ev.target && ev.target.closest && ev.target.closest('button, [role="button"], a');
        if (!btn) return;
        if (!isAckButton(btn)) return;
        const host = findWarningHost(btn);
        if (!host) return;

        ev.preventDefault();
        try { btn.type = 'button'; } catch(_){}
        try { closeModalHost(host); } catch(_){}
        setTimeout(function(){
          if (window.WaitOverlay && typeof window.WaitOverlay.suspend === 'function') {
            window.WaitOverlay.suspend(true);
            setTimeout(function(){ window.WaitOverlay.suspend(false); }, 250);
          }
          if (typeof window._wipeAndReload === 'function') {
            window._wipeAndReload();
          } else {
            location.reload();
          }
        }, 60);
      }, true);

      const moBtns = new MutationObserver(function(muts){
        muts.forEach(function(m){
          m.addedNodes && m.addedNodes.forEach(function(n){
            if (n.nodeType !== 1) return;
            const btns = n.matches && isAckButton(n) ? [n] : (n.querySelectorAll ? Array.from(n.querySelectorAll('button, [role="button"], a')) : []);
            btns.forEach(function(b){
              if (!isAckButton(b)) return;
              const host = findWarningHost(b);
              if (!host) return;
              b.type = 'button';
              b.onclick = function(e){ e.preventDefault(); closeModalHost(host); setTimeout(function(){ window._wipeAndReload(); }, 40); return false; };
            });
          });
        });
      });
      moBtns.observe(document.body, { childList:true, subtree:true });
    })();

  </script>

  <!-- Dismissable μόνο για flash/alerts (hook για δυναμικά) -->
  <script>
    (function(){
      const SELECTORS = ['[data-flash]', '.flash', '.alert', '[role="alert"]'];
      const AUTO_HIDE_MS = 0; // βάλε 6000 αν θέλεις αυτομάτως να κλείνουν

      function makeDismissable(el){
        if (!el || el.dataset.dismissable === '1') return;
        el.dataset.dismissable = '1';

        const btn = document.createElement('button');
        btn.type = 'button';
        btn.setAttribute('aria-label','Close');
        btn.textContent = '×';
        btn.style.cssText =
          'position:absolute;top:.4rem;right:.5rem;line-height:1;font-size:20px;' +
          'opacity:.75;cursor:pointer;background:transparent;border:0;padding:0;z-index:1';

        const cs = getComputedStyle(el);
        if (cs.position === 'static') el.style.position = 'relative';
        if (!el.style.paddingRight) {
          const pr = parseFloat(cs.paddingRight || '0');
          if (pr < 22) el.style.paddingRight = '28px';
        }
        btn.addEventListener('click', ()=> { try{ el.remove(); }catch(_){ } });
        el.appendChild(btn);

        if (AUTO_HIDE_MS > 0) setTimeout(()=>{ try{ el.remove(); }catch(_){ } }, AUTO_HIDE_MS);
      }

      function scan(root=document){
        root.querySelectorAll(SELECTORS.join(',')).forEach(makeDismissable);
      }

      if (document.readyState === 'loading'){
        document.addEventListener('DOMContentLoaded', ()=>scan(), { once:true });
      } else {
        scan();
      }

      const mo = new MutationObserver(muts=>{
        for (const m of muts) m.addedNodes && m.addedNodes.forEach(n=>{
          if (n.nodeType===1) scan(n);
        });
        });
      mo.observe(document.body, { childList:true, subtree:true });

      document.addEventListener('click', (e)=>{
        const b = e.target.closest && e.target.closest('[data-dismiss="flash"], .btn-close, .close');
        if (!b) return;
        const host = b.closest(SELECTORS.join(',')) || b.parentElement;
        if (host) { e.preventDefault(); try{ host.remove(); }catch(_){ } }
      }, true);
    })();

    // Side menu toggle functionality
    document.addEventListener('DOMContentLoaded', function(){
      const sideMenu = document.getElementById('sideMenu');
      const sideMenuOverlay = document.getElementById('sideMenuOverlay');
      const sideMenuToggle = document.getElementById('sideMenuToggle');
      const sideMenuClose = document.getElementById('sideMenuClose');
      const groupsList = document.getElementById('groupsList');

      if (!sideMenu || !sideMenuToggle) return;

      // Toggle side menu open/close (right-side menu)
      function toggleMenu() {
        sideMenu.classList.toggle('translate-x-full');
        sideMenuOverlay.classList.toggle('opacity-0');
        sideMenuOverlay.classList.toggle('invisible');
      }

      if (sideMenuToggle) {
        sideMenuToggle.addEventListener('click', toggleMenu);
      }

      if (sideMenuClose) {
        sideMenuClose.addEventListener('click', toggleMenu);
      }

      if (sideMenuOverlay) {
        sideMenuOverlay.addEventListener('click', toggleMenu);
      }

      // Populate groups list from page
      if (groupsList) {
        try {
          fetch('/api/user_groups')
            .then(r => r.json())
            .then(data => {
              if (data.groups && Array.isArray(data.groups)) {
                groupsList.innerHTML = data.groups.map(g => `
                  <button type="button" onclick="selectGroup('${g.name.replace(/'/g,"\\'") }')" 
                          class="w-full text-left px-3 py-2 rounded text-sm hover:bg-sky-100 text-gray-700 border border-gray-200">
                    ${g.name === data.active_group ? '✓ ' : ''}${escapeHtml(g.name)}
                  </button>
                `).join('');
              }
            })
            .catch(err => console.warn('Failed to load groups:', err));
        } catch (e) {
          console.warn('Groups list error:', e);
        }
      }

      // Helper to select a group
      // Select a group without interactive warning
      window.selectGroup = function(groupName) {
        fetch('/groups/select', {
          method: 'POST',
          credentials: 'same-origin',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({group: groupName})
        })
        .then(async r => {
          const j = await r.json().catch(()=> ({}));
          if (r.ok && j.ok) {
            // close menu and reload
            try { toggleMenu(); } catch(_) {}
            window.location.reload();
          } else if (j && j.error) {
            showModalAlert('Σφάλμα', j.error);
          } else {
            showModalAlert('Σφάλμα', 'Failed to select group');
          }
        })
        .catch(err => showModalAlert('Σφάλμα', 'Request failed: ' + err));
      };
    });
    
    // Dark mode toggle functionality
    const themeToggle = document.getElementById('themeToggle');
    const htmlElement = document.documentElement;
    
    // Check for saved theme preference or default to light mode
    const currentTheme = localStorage.getItem('theme') || 'light';
    htmlElement.setAttribute('data-theme', currentTheme);
    if (themeToggle) {
      themeToggle.checked = currentTheme === 'dark';
      
      themeToggle.addEventListener('change', function() {
        const newTheme = this.checked ? 'dark' : 'light';
        htmlElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      });
    }
    
    // Highlight matching links inside the side menu (both light & dark)
    document.addEventListener('DOMContentLoaded', function(){
      try {
        const side = document.getElementById('sideMenu');
        if (!side) return;
        const anchors = Array.from(side.querySelectorAll('a'));
        const path = window.location.pathname.replace(/\/$/, '');
        anchors.forEach(a => {
          try {
            const href = (a.getAttribute('href') || '').replace(/\/$/, '');
            if (!href) return;
            // mark active when the current path starts with the link href (covers subpages)
            if (path === href || path.indexOf(href) === 0 || href.indexOf(path) === 0) {
              a.classList.add('side-menu-active');
            } else {
              a.classList.remove('side-menu-active');
            }
          } catch(_){ }
        });
      } catch (e) { console.warn('side menu highlight error', e); }
    });
  </script></body>
</html>
